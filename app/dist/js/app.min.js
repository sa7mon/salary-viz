"use strict";var csvData;function loadData(e){null!==localStorage.getItem("csvData")?(console.log("Using csvdata from LocalStorage..."),e(JSON.parse(localStorage.getItem("csvData")))):$.ajax({type:"GET",url:"data/data_sampled.csv",dataType:"text",success:function(t){for(var a=(csvData=$.csv.toObjects(t)).length-1;0<=a;a--)void 0!==csvData[a].BASE&&(csvData[a].BASE=Number(csvData[a].BASE.replace("$","").replace(",",""))),void 0!==csvData[a].YTD&&(csvData[a].YTD=Number(csvData[a].YTD.replace("$","").replace(",","")));localStorage.setItem("csvData",JSON.stringify(csvData)),e(csvData)},error:function(t){console.log("[loadData] Error loading data: ",t)}})}function createTable(t){var a=$("#salary-table").DataTable({data:t,columns:[{data:"FIRST_LAST_INITIALS",title:"Initials"},{data:"LONG_DESC",title:"Description",render:function(t,a,e){return"sort"===a||"type"===a||""==t?t:cleanCollegeName(t)}},{data:"COL_DIV_CODE",title:"Department",render:function(t,a,e){return"sort"===a||"type"===a||""==t?t:cleanCollegeName(t)}},{data:"JOB_TITLE",title:"Job Title"},{data:"TENURE_DEC_YR_MO",title:"Tenure Date",render:function(t,a,e){return"sort"===a||"type"===a||""==t?t:moment(t,"YYYYMM").format("MMMM YYYY")}},{data:"EMPT_STATE_DATE",title:"Start Date",render:function(t,a,e){return"sort"===a||"type"===a||""==t?t:moment(t,"YYYYMMDD").format("MMM DD, YYYY")}},{data:"BASE",title:"Base",render:renderMoney},{data:"YTD",title:"YTD",render:renderMoney}],orderCellsTop:!0,fixedHeader:!0,responsive:!0});a.on("responsive-resize",function(t,a,e){for(var r=$("#salary-table th input.table-search"),n=0;n<r.length;n++)1==e[n]?r.eq(n).show():r.eq(n).hide()});var e=$("#salary-table thead tr:eq(0) th").length;$("#salary-table thead").append("<tr></tr>");for(var r=0;r<e;r++)$("#salary-table thead tr:eq(1)").append("<th></th>");$("#salary-table thead tr:eq(1) th").each(function(t){0==t?$(this).html('<input type="text" class="table-search width-0" placeholder="Search" />'):4==t||5==t||6==t||7==t?$(this).html('<input type="text" class="table-search width-1" placeholder="Search" />'):$(this).html('<input type="text" class="table-search" placeholder="Search" />'),$("input",this).on("keyup change",function(){a.column(t).search()!==this.value&&a.column(t).search(this.value).draw()})})}function graph2(a){var t=a.reduce(function(t,a){return a.avg_base>t.avg_base?a:t}),e=d3.select("svg#bar-chart"),r=e.append("g").attr("transform","translate(300, 30)"),n=d3.scaleLinear().range([600,0]).domain([t.avg_base,0]);r.append("g").attr("transform","translate(0, 0)").attr("class","x-axis").call(d3.axisTop(n));var l=d3.scaleBand().range([0,840]).domain(a.map(function(t){return t.COL_DIV_CODE})).padding(.2),s=d3.axisLeft(l).tickFormat(function(t){return t});function c(){l.domain(a.map(function(t){return t.COL_DIV_CODE})),e.selectAll(".bar").transition().duration(500).attr("y",function(t,a){return l(t.COL_DIV_CODE)}),r.select("g.y-axis").transition().duration(500).call(s)}r.append("g").attr("transform","translate(0, 0)").attr("class","y-axis").call(d3.axisLeft(l).tickFormat(function(t){return cleanCollegeName(t)})),d3.selectAll(".y-axis .tick text").attr("class","bar-label"),r.append("g").attr("class","grid").call(d3.axisTop().scale(n).tickSize(-840,0,0).tickFormat("")),r.selectAll().data(a).enter().append("rect").attr("class","bar").attr("style","fill: steelblue").attr("y",function(t){return l(t.COL_DIV_CODE)}).attr("x",0).attr("width",function(t){return n(t.avg_base)}).attr("height",l.bandwidth()),d3.selectAll(".bar").on("mouseover",function(){d3.select(this).style("fill","#343a40")}).on("mouseout",function(){d3.select(this).style("fill","steelblue")}),d3.select("#sort-value-asc").on("click",function(){a.sort(function(t,a){return d3.ascending(t.avg_base,a.avg_base)}),c()}),d3.select("#sort-value-desc").on("click",function(){a.sort(function(t,a){return d3.descending(t.avg_base,a.avg_base)}),c()}),d3.select("#sort-college-asc").on("click",function(t){a.sort(function(t,a){return d3.ascending(t.COL_DIV_CODE,a.COL_DIV_CODE)}),c()}),d3.select("#sort-college-desc").on("click",function(t){a.sort(function(t,a){return d3.descending(t.COL_DIV_CODE,a.COL_DIV_CODE)}),c()})}function graphAverages(t){var a=t.reduce(function(t,a){return a.avg_base>t.avg_base?a:t}),e=d3.select("svg"),r=e.append("g").attr("transform","translate(80, 80)"),n=d3.scaleLinear().range([440,0]).domain([0,a.avg_base]);r.append("g").call(d3.axisLeft(n));var l=d3.scaleBand().range([0,1040]).domain(t.map(function(t){return t.COL_DIV_CODE})).padding(.2);r.append("g").attr("transform","translate(0, 440)").call(d3.axisBottom(l)).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-35)"),r.append("g").attr("class","grid").call(d3.axisLeft().scale(n).tickSize(-1040,0,0).tickFormat("")),r.selectAll().data(t).enter().append("rect").attr("style","fill: steelblue").attr("x",function(t){return l(t.COL_DIV_CODE)}).attr("y",function(t){return n(t.avg_base)}).attr("height",function(t){return 440-n(t.avg_base)}).attr("width",l.bandwidth()),e.append("text").attr("x",-300).attr("y",80/2.4).attr("transform","rotate(-90)").attr("text-anchor","middle").text("Base ($)")}function renderMoney(t,a,e){return"sort"===a||"type"===a||""==t?t:"$"+formatMoney(t,2,".",",")}function formatMoney(t,a,e,r){a=isNaN(a=Math.abs(a))?2:a,e=null==e?".":e,r=null==r?",":r;var n=t<0?"-":"",l=String(parseInt(t=Math.abs(Number(t)||0).toFixed(a))),s=3<(s=l.length)?s%3:0;return n+(s?l.substr(0,s)+r:"")+l.substr(s).replace(/(\d{3})(?=\d)/g,"$1"+r)+(a?e+Math.abs(t-l).toFixed(a).slice(2):"")}function groupByCollege(t){for(var a={},e=0,r=t.length;e<r;e++){var n=t[e];null==a[n.COL_DIV_CODE]?(a[n.COL_DIV_CODE]={},a[n.COL_DIV_CODE].sum=n.BASE,a[n.COL_DIV_CODE].count=1):(a[n.COL_DIV_CODE].sum+=n.BASE,a[n.COL_DIV_CODE].count+=1),a[n.COL_DIV_CODE].average=a[n.COL_DIV_CODE].sum/a[n.COL_DIV_CODE].count}var l=[];for(var s in a){var c={};c.COL_DIV_CODE=cleanCollegeName(s),c.avg_base=a[s].average,l.push(c)}return console.log(l),l}function findObjectByCollegeName(t,a){for(var e=0;e<a.length;e++)if(a[e].COL_DIV_CODE==t)return a[e]}function cleanCollegeName(t){return null===t.match(/,.+ of/g)?t:t.substr(t.lastIndexOf(",")+1,t.length).trim()+" "+t.substr(0,t.lastIndexOf(","))}