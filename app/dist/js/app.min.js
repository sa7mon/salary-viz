"use strict";var csvData;function loadData(a){null!==localStorage.getItem("csvData")?(console.log("Using csvdata from LocalStorage..."),a(JSON.parse(localStorage.getItem("csvData")))):$.ajax({type:"GET",url:"data/data_sampled.csv",dataType:"text",success:function(t){for(var e=(csvData=$.csv.toObjects(t)).length-1;0<=e;e--)void 0!==csvData[e].BASE&&(csvData[e].BASE=Number(csvData[e].BASE.replace("$","").replace(",",""))),void 0!==csvData[e].YTD&&(csvData[e].YTD=Number(csvData[e].YTD.replace("$","").replace(",","")));localStorage.setItem("csvData",JSON.stringify(csvData)),a(csvData)},error:function(t){console.log("[loadData] Error loading data: ",t)}})}function createTable(t){var e=$("#salary-table").DataTable({data:t,columns:[{data:"FIRST_LAST_INITIALS",title:"Initials"},{data:"LONG_DESC",title:"Description",render:function(t,e,a){return"sort"===e||"type"===e||""==t?t:cleanCollegeName(t)}},{data:"COL_DIV_CODE",title:"Department",render:function(t,e,a){return"sort"===e||"type"===e||""==t?t:cleanCollegeName(t)}},{data:"JOB_TITLE",title:"Job Title"},{data:"TENURE_DEC_YR_MO",title:"Tenure Date",render:function(t,e,a){return"sort"===e||"type"===e||""==t?t:moment(t,"YYYYMM").format("MMMM YYYY")}},{data:"EMPT_STATE_DATE",title:"Start Date",render:function(t,e,a){return"sort"===e||"type"===e||""==t?t:moment(t,"YYYYMMDD").format("MMM DD, YYYY")}},{data:"BASE",title:"Base",render:renderMoney},{data:"YTD",title:"YTD",render:renderMoney}],orderCellsTop:!0,fixedHeader:!0,responsive:!0});e.columns().eq(0).each(function(t){console.log("column["+t+"]: ",e.column(t).responsiveHidden()),0==e.column(t).responsiveHidden()&&(console.log("Column to hide: ",t),$("#salary-table th input.table-search").eq(t).hide())}),console.log("count: ",e.columns().eq(0).length),e.on("responsive-resize",function(t,e,a){for(var n=$("#salary-table th input.table-search"),r=0;r<n.length;r++)1==a[r]?n.eq(r).show():n.eq(r).hide()});var a=$("#salary-table thead tr:eq(0) th").length;$("#salary-table thead").append("<tr></tr>");for(var n=0;n<a;n++)$("#salary-table thead tr:eq(1)").append("<th></th>");$("#salary-table thead tr:eq(1) th").each(function(t){0==t?$(this).html('<input type="text" class="table-search width-0" placeholder="Search" />'):4==t||5==t||6==t||7==t?$(this).html('<input type="text" class="table-search width-1" placeholder="Search" />'):$(this).html('<input type="text" class="table-search" placeholder="Search" />'),$("input",this).on("keyup change",function(){e.column(t).search()!==this.value&&e.column(t).search(this.value).draw()})})}function graph(e,t){var a=300,n=e.reduce(function(t,e){return e.avg>t.avg?e:t}),r=d3.select("svg#bar-chart"),l=r.append("g").attr("transform","translate(300, 50)"),o=d3.scaleLinear().range([600,0]).domain([n.avg,0]);l.append("g").attr("transform","translate(0, 0)").attr("class","x-axis").call(d3.axisTop(o));var c=d3.scaleBand().range([0,800]).domain(e.map(function(t){return t.COL_DIV_CODE})).padding(.2),s=d3.axisLeft(c).tickFormat(function(t){return t});function i(){c.domain(e.map(function(t){return t.COL_DIV_CODE})),r.selectAll(".bar").transition().duration(500).attr("y",function(t,e){return c(t.COL_DIV_CODE)}),r.selectAll(".label").transition().duration(500).attr("y",function(t,e){return console.log("moving text"),c(t.COL_DIV_CODE)+55}),l.select("g.y-axis").transition().duration(500).call(s)}l.append("g").attr("transform","translate(0, 0)").attr("class","y-axis").call(d3.axisLeft(c).tickFormat(function(t){return cleanCollegeName(t)})),d3.selectAll(".y-axis .tick text").attr("class","bar-label"),l.append("g").attr("class","grid").call(d3.axisTop().scale(o).tickSize(-800,0,0).tickFormat("")),l.selectAll().data(e).enter().append("rect").attr("class","bar").attr("style","fill: #343a40").attr("y",function(t){return c(t.COL_DIV_CODE)}).attr("x",0).attr("width",function(t){return o(t.avg)}).attr("height",c.bandwidth()),r.selectAll(".text").data(e).enter().append("text").attr("class","label").attr("x",function(t){return a+o(t.avg)/2-30}).attr("y",function(t){return c(t.COL_DIV_CODE)+c.bandwidth()+32}).attr("dy",".75em").text(function(t){return"$"+formatMoney(t.avg,2,".",",")}),d3.selectAll(".bar").on("mouseover",function(){d3.select(this).style("fill","steelblue")}).on("mouseout",function(){d3.select(this).style("fill","#343a40")}),r.append("text").attr("x",600).attr("y",10).attr("text-anchor","middle").text(t),d3.select("#sort-value-asc").on("click",function(){e.sort(function(t,e){return d3.ascending(t.avg,e.avg)}),i()}),d3.select("#sort-value-desc").on("click",function(){e.sort(function(t,e){return d3.descending(t.avg,e.avg)}),i()}),d3.select("#sort-college-asc").on("click",function(t){e.sort(function(t,e){return d3.ascending(t.COL_DIV_CODE,e.COL_DIV_CODE)}),i()}),d3.select("#sort-college-desc").on("click",function(t){e.sort(function(t,e){return d3.descending(t.COL_DIV_CODE,e.COL_DIV_CODE)}),i()})}function renderMoney(t,e,a){return"sort"===e||"type"===e||""==t?t:"$"+formatMoney(t,2,".",",")}function formatMoney(t,e,a,n){e=isNaN(e=Math.abs(e))?2:e,a=null==a?".":a,n=null==n?",":n;var r=t<0?"-":"",l=String(parseInt(t=Math.abs(Number(t)||0).toFixed(e))),o=3<(o=l.length)?o%3:0;return r+(o?l.substr(0,o)+n:"")+l.substr(o).replace(/(\d{3})(?=\d)/g,"$1"+n)+(e?a+Math.abs(t-l).toFixed(e).slice(2):"")}function groupByCollege(t,e){for(var a={},n=0,r=t.length;n<r;n++){var l=t[n];null==a[l.COL_DIV_CODE]?(a[l.COL_DIV_CODE]={},a[l.COL_DIV_CODE].sum=l[e],a[l.COL_DIV_CODE].count=1):(a[l.COL_DIV_CODE].sum+=l[e],a[l.COL_DIV_CODE].count+=1),a[l.COL_DIV_CODE].average=a[l.COL_DIV_CODE].sum/a[l.COL_DIV_CODE].count}var o=[];for(var c in a){var s={};s.COL_DIV_CODE=cleanCollegeName(c),s.avg=a[c].average,o.push(s)}return console.log(o),o}function findObjectByCollegeName(t,e){for(var a=0;a<e.length;a++)if(e[a].COL_DIV_CODE==t)return e[a]}function cleanCollegeName(t){return null===t.match(/,.+ of/g)?t:t.substr(t.lastIndexOf(",")+1,t.length).trim()+" "+t.substr(0,t.lastIndexOf(","))}function clearGraph(){d3.selectAll("svg#bar-chart > *").remove()}